#!/bin/bash

# azilink_ovpn=/home/blackdracula18/connections/azilink/azilink.ovpn

clean_first()
{
	killall openvpn
	adb kill-server
	echo "#Generated By Azilink" > /etc/resolv.conf
}

stop_network_manager()
{
	systemctl stop NetworkManager 2>/dev/null
	if [ "$?" -eq "0" ]; then
    	echo "Disable Network Manager"
    else
    	echo "Something went wrong networkmanager not ready to die"
    fi

}

init_nameserver()
{
	echo "nameserver 192.168.56.1" >> /etc/resolv.conf
	if [ "$?" -eq "0" ]; then
    	echo "nameserver all set"
    else
    	echo "Something went wrong check nameserver permission"
    fi
}

start_adb()
{
	adb forward tcp:41927 tcp:41927
	if [ "$?" -eq "0" ]; then
    	echo "adb forward done...."
    else
    	echo "Something went wrong \nPls ensure u connect ur phone"
    fi
}


start_azilink()
{
	openvpn /root/bin/azilink.ovpn > /dev/null
	if [ "$?" -eq "0" ]; then
    	echo "all set tryping ping google.com"
    else
	openvpn /root/bin/azilink.ovpn & disown > /dev/null #force this shit to work anyway
    fi
}

clean_first #make sure that everything is set
stop_network_manager #as the name said
init_nameserver #sending namerser to resolve.conf
start_adb #starting adb at port 4197
start_azilink #opening the ovpn file
